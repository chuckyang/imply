"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tslib_1=require("tslib");var path=require("path");var imply_ui_common_1=require("@implydata/imply-ui-common");var immutable_class_1=require("immutable-class");var state_store_options_1=require("../state-store-options/state-store-options");var models_1=require("@implydata/pivot/build/common/models");function basicEqual(e,t){return Boolean(e)===Boolean(t)}var ServerConfig=function(e){tslib_1.__extends(t,e);function t(t){var a=e.call(this,t)||this;a.serverConfigFileDir=t.serverConfigFileDir||process.cwd();if(a.userMode==="ldap-authentication"){if(!a.ldapOptions)throw new Error("ldapOptions must be configured if you have ldap-authentication enabled");if(!a.ldapOptions.url)throw new Error("ldapOptions must include a url")}return a}t.fromJS=function(e,a){if(a===void 0){a={}}if(!e.initialSettings&&(e.settings||(e.stateStore||{}).initialSettings)){e.initialSettings=e.settings||(e.stateStore||{}).initialSettings}var i=immutable_class_1.BaseImmutable.jsToValue(t.PROPERTIES,e);if(a.serverConfigFilePath){i.serverConfigFileDir=path.dirname(a.serverConfigFilePath)}return new t(i)};t.prototype.valueOf=function(){var t=e.prototype.valueOf.call(this);t.serverConfigFileDir=this.serverConfigFileDir;return t};t.prototype.needsLogin=function(){var e=this.getUserMode();return["native-users","ldap-authentication"].includes(e)};t.prototype.isStateful=function(){return!this.readOnly};t.prototype.resolvePath=function(e){return path.resolve(this.serverConfigFileDir,e.replace(/\$var/g,this.getResolvedVarDir()).replace(/\$cwd/g,function(){return process.cwd()}))};t.prototype.getResolvedDecorators=function(){var e=this.getDecorators();var t={};for(var a in e){t[a]=this.resolvePath(e[a])}return t};t.prototype.getResolvedVarDir=function(){return path.resolve(this.getVarDir())};t.prototype.getResolvedLicenseFile=function(){return this.resolvePath(this.getLicenseFile())};t.DEFAULT_QUERY_CACHE_CONFIG={type:"local"};t.USER_MODES=["all-users","all-admin","all-dashboard-only-users","native-users","ldap-authentication","header-user"];t.DEFAULT_USER_MODE="all-admin";t.ROLE_AUTHORITIES=["native","ldap"];t.DEFAULT_ROLE_AUTHORITY="native";t.PROPERTIES=[{name:"initialSettings",defaultValue:models_1.AppSettings.BLANK,immutableClass:models_1.AppSettings},{name:"readOnly",defaultValue:false},{name:"userMode",defaultValue:t.DEFAULT_USER_MODE,possibleValues:t.USER_MODES},{name:"roleAuthority",defaultValue:t.DEFAULT_ROLE_AUTHORITY,possibleValues:t.ROLE_AUTHORITIES},{name:"userNameLabel",defaultValue:"Email"},{name:"suppressUserIcon",defaultValue:false},{name:"appName",defaultValue:"Imply"},{name:"ldapOptions",defaultValue:null},{name:"stateStore",defaultValue:null,immutableClass:state_store_options_1.StateStoreOptions},{name:"sessionStore",defaultValue:null},{name:"sessionSecret",defaultValue:"You are not getting thorough here fool."},{name:"queryCache",defaultValue:t.DEFAULT_QUERY_CACHE_CONFIG},{name:"maxUrlEntries",defaultValue:5e4},{name:"decorators",defaultValue:{},equal:basicEqual},{name:"varDir",defaultValue:"var/pivot"},{name:"licenseFile",defaultValue:"pivot-license"},{name:"cookieMaxAge",defaultValue:2592e6},{name:"purePivot",defaultValue:false},{name:"fixedConnections",defaultValue:null,immutableClassArray:imply_ui_common_1.Connection,emptyArrayIsOk:true},{name:"implyTokenSecret",defaultValue:null}];return t}(immutable_class_1.BaseImmutable);exports.ServerConfig=ServerConfig;immutable_class_1.BaseImmutable.finalize(ServerConfig);