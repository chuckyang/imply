"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tslib_1=require("tslib");var toArray=require("stream-to-array");var plywood_druid_requester_1=require("plywood-druid-requester");var DruidRequester=function(){function r(r,e){var t=r.connection,o=r.logger,s=r.decorators;var u=null;if(t.decorator){if(!s)throw new Error("must have decorators");var i=s.getDecoratorModule(t.decorator);if(!i)throw new Error("decorator '"+t.decorator+"' not found");u=i.druidRequestDecoratorFactory(o,{options:t.decoratorOptions||{},cluster:t})}this.requester=plywood_druid_requester_1.druidRequesterFactory({host:t.queryHosts[0],timeout:t.getTimeout(),protocol:t.protocol,ca:t.ca,requestDecorator:u,authToken:e||t.defaultDbAuthToken,socksHost:t.socksHost,socksUsername:t.socksUsername,socksPassword:t.socksPassword})}r.prototype.getAllSegmentMetadata=function(){return tslib_1.__awaiter(this,void 0,void 0,function(){return tslib_1.__generator(this,function(r){return[2,toArray(this.requester({query:{query:"SELECT TABLE_NAME, COLUMN_NAME, DATA_TYPE FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA = 'druid'"}}))]})})};r.prototype.getDataSources=function(){return tslib_1.__awaiter(this,void 0,void 0,function(){var r;return tslib_1.__generator(this,function(e){switch(e.label){case 0:return[4,toArray(this.requester({query:{queryType:"sourceList"}}))];case 1:r=e.sent();return[2,[].concat.apply([],r)]}})})};r.prototype.query=function(r,e){return tslib_1.__awaiter(this,void 0,void 0,function(){return tslib_1.__generator(this,function(t){return[2,toArray(this.requester({query:{query:r,context:e}}))]})})};return r}();exports.DruidRequester=DruidRequester;