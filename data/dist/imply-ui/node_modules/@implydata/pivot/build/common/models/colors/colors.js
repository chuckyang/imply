"use strict";Object.defineProperty(exports,"__esModule",{value:true});var hasOwnProperty=require("has-own-prop");var immutable_class_1=require("immutable-class");var plywood_1=require("plywood");var NULL_COLOR="#666666";var NORMAL_COLORS=["#2D95CA","#EFB925","#DA4E99","#4CC873","#745CBD","#EA7136","#E68EE0","#218C35","#B0B510","#904064"];function valuesToJS(e){var t={};for(var i=0;i<NORMAL_COLORS.length;i++){if(!hasOwnProperty(e,i))continue;t[i]=plywood_1.valueToJS(e[i])}return t}function valueEquals(e,t){if(e===t)return true;if(!e!==!t)return false;if(e.toISOString&&t.toISOString)return e.valueOf()===t.valueOf();if(immutable_class_1.isImmutableClass(e))return e.equals(t);return false}function valuesEqual(e,t){if(!Boolean(e)===Boolean(t))return false;if(e===t)return true;if(!e!==!t)return false;if(typeof e!==typeof t)return false;for(var i=0;i<NORMAL_COLORS.length;i++){var n=e[i];var r=t[i];if(hasOwnProperty(e,i)!==hasOwnProperty(t,i))return false;if(!valueEquals(n,r))return false}return true}function cloneValues(e){var t={};for(var i=0;i<NORMAL_COLORS.length;i++){if(!hasOwnProperty(e,i))continue;t[i]=e[i]}return t}var check;var Colors=function(){function e(e){this.dimension=e.dimension;this.actualDimension=e.actualDimension;if(!this.dimension)throw new Error("must have dimension name");if(this.actualDimension&&this.dimension&&this.actualDimension.name!==this.dimension){throw new Error("actualDimension and dimension are mismatched")}this.values=e.values;this.hasNull=e.hasNull;this.limit=e.limit;if(!this.values&&!this.limit)throw new Error("must have values or limit")}e.fromLimit=function(t,i){return new e({actualDimension:t,dimension:t.name,limit:i})};e.fromValues=function(t,i){var n={};var r=false;var s=Math.min(i.length,NORMAL_COLORS.length+1);var u=0;var l=0;while(u<s){var a=i[u];if(a===null){r=true}else{n[l]=a;l++}u++}return new e({actualDimension:t,dimension:t.name,hasNull:r,values:n})};e.fromJS=function(t,i){if(i===void 0){i={}}var n=t.dimension;var r={dimension:n,limit:t.limit};var s;if(i.actualDimensions)s=immutable_class_1.NamedArray.findByName(i.actualDimensions,n);if(i.actualDimension)s=i.actualDimension;r.actualDimension=s;var u=t.values;if(u){var l=Boolean(t.hasNull);var a={};for(var o=0;o<NORMAL_COLORS.length;o++){if(!hasOwnProperty(u,o))continue;var h=u[o];if(h===null){l=true}else{a[o]=plywood_1.valueFromJS(h)}}r.values=a;r.hasNull=l}return new e(r)};e.prototype.valueOf=function(){return{actualDimension:this.actualDimension,dimension:this.dimension,values:this.values,hasNull:this.hasNull,limit:this.limit}};e.prototype.toJS=function(){var e={dimension:this.dimension};if(this.values)e.values=valuesToJS(this.values);if(this.hasNull)e.hasNull=true;if(this.limit)e.limit=this.limit;return e};e.prototype.toJSON=function(){return this.toJS()};e.prototype.toString=function(){var e=this,t=e.dimension,i=e.values;var n=i?", "+Object.keys(i).map(function(e){return i[e]}):"";return"[Colors: "+t+n+"]"};e.prototype.equals=function(t){return t instanceof e&&this.dimension===t.dimension&&valuesEqual(this.values,t.values)&&this.hasNull===t.hasNull&&this.limit===t.limit};e.prototype.getActualDimension=function(){var e=this.actualDimension;if(!e)throw new Error("must have actual dimension");return e};e.prototype.numColors=function(){var e=this,t=e.values,i=e.limit;if(t){return Object.keys(t).length+Number(this.hasNull)}return i};e.prototype.isLimitMode=function(){var e=this.values;return!e};e.prototype.toArray=function(){var e=this,t=e.values,i=e.hasNull;if(!t)return null;var n=[];if(i)n.push(null);for(var r=0;r<NORMAL_COLORS.length;r++){if(!hasOwnProperty(t,r))continue;n.push(t[r])}return n};e.prototype.toSet=function(){if(!this.values)return null;return plywood_1.Set.fromJS(this.toArray())};e.prototype.toHavingFilter=function(e){var t=this,i=t.dimension,n=t.values;if(!e)e=i;if(!n)return null;return plywood_1.Expression._.filter(plywood_1.$(e).overlap(this.toSet()))};e.prototype.toLimitAction=function(){return plywood_1.Expression._.limit(this.numColors())};e.prototype.toggle=function(e){return this.has(e)?this.remove(e):this.add(e)};e.prototype.valueIndex=function(e){var t=this.values;if(!t||e==null)return-1;for(var i=0;i<NORMAL_COLORS.length;i++){if(!hasOwnProperty(t,i))continue;if(valueEquals(t[i],e))return i}return-1};e.prototype.nextIndex=function(){var e=this.values;if(!e)return 0;for(var t=0;t<NORMAL_COLORS.length;t++){if(hasOwnProperty(e,t))continue;return t}return-1};e.prototype.has=function(e){if(e==null)return this.hasNull;return this.valueIndex(e)!==-1};e.prototype.add=function(t){if(this.has(t))return this;var i=this.valueOf();if(t===null){i.hasNull=true}else{var n=this.nextIndex();if(n===-1)return this;i.values=i.values?cloneValues(i.values):{};i.values[n]=t;delete i.limit}return new e(i)};e.prototype.remove=function(t){if(!this.has(t))return this;var i=this.valueOf();if(t==null){i.hasNull=false}else{var n=this.valueIndex(t);if(n===-1)return this;i.values=cloneValues(i.values);delete i.values[n];delete i.limit}return new e(i)};e.prototype.getColor=function(e){var t=this,i=t.values,n=t.hasNull;if(i){if(e===null&&n)return NULL_COLOR;var r=this.valueIndex(e);return r===-1?null:NORMAL_COLORS[r]}else{return null}};return e}();exports.Colors=Colors;check=Colors;