"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tslib_1=require("tslib");var immutable_class_1=require("immutable-class");var moment=require("moment");function shorten(e){return parseFloat(e.toPrecision(4)).toString()}var durations={years:"y",months:"mo",days:"d",hours:"h",minutes:"m",seconds:"s",milliseconds:"ms"};var NumberStyle=function(e){tslib_1.__extends(t,e);function t(t){return e.call(this,t)||this}t.getMiddleNonZeroNumber=function(e){var t=[];for(var a=0,i=e;a<i.length;a++){var r=i[a];if(r===0||isNaN(r)||!isFinite(r))continue;t.push(Math.abs(r))}var n=t.length;if(n){t.sort(function(e,t){return t-e});return t[Math.ceil((n-1)/2)]}else{return 0}};t.scalePowTen=function(e,t){if(e.toString().includes("e")){return e*Math.pow(10,t)}else{return Number(e+"e+"+t)}};t.logScale=function(e,t){e=Math.round(e);var a=0;while(t<=e){e=Math.round(e/t);a++}return a};t.formatSeconds=function(e){e=Math.abs(e);var t=Math.floor(e/60/60);var a=Math.floor((e-t*60*60)/60);var i=Math.round(e-t*60*60-a*60);return t+":"+(a<10?"0"+a:a)+":"+(i<10?"0"+i:i)};t.now=function(){return Date.now()};t.formatDuration=function(e){var t=[];var a=0;for(var i in durations){var r=moment.duration(e).get(i);if(r>0){if(i==="seconds"&&a===0){t.push(shorten(e/1e3)+durations[i]);break}t.push(r+durations[i]);a++;if(a>=2)break}else if(a>0){break}}return t.length?t.join(" "):"0"};t.fromNumeralFormat=function(e){var a={};if(e==="00:00:00"){a.type="seconds-as-time";return t.fromJS(a)}if(e==="duration"||e==="duration-ago"){a.type=e;return t.fromJS(a)}if(e.includes("(")){a.negativeParentheses=true;e=e.replace(/[\(|\)]/g,"")}else if(e.includes("-")||e.includes("+")){a.signed=e.includes("+");e=e.replace(/[\+|\-]/g,"")}var i=e.match(/^(\$\s*)?([0,.\[\]]+)( )?(a[kmbt]?|b|ib|B|bps|ibps|bpsd|ms|%)?(I)?(#\w+)?$/);if(i){var r=i[0],n=i[1],s=i[2],l=i[3],o=i[4],u=i[5],b=i[6];e=s;if(l){a.abbreviationSpace=true}if(n){if(o&&o[0]==="a"){a.type="dollar";if(o[1])a.forceAbbreviation=t.SI_ABBREVIATIONS.indexOf(o[1])}else{a.type="dollar-raw"}}else{if(o){if(o[0]==="a"){a.type="si";if(o[1])a.forceAbbreviation=t.SI_ABBREVIATIONS.indexOf(o[1])}else{switch(o){case"B":a.type="byte";break;case"bps":a.type="bit-per-second";break;case"ibps":a.type="bit-per-second-iec";break;case"bpsd":a.type="bit-per-second-decimal";break;case"b":a.type="byte-decimal";break;case"ib":a.type="byte-iec";break;case"ms":a.type="millisecond";break;case"%":a.type="percent";break;default:return null}}}}if(u){a.integer=true}if(b){a.rawUnit=b.substr(1,4)}}else{return null}if(e.includes("[.]")){a.optionalDecimal=true;e=e.replace("[.]",".")}var c=e.split("."),m=c[0],f=c[1];if(!m.includes(",")){a.thousandsDelimiter=""}a.leading=(m.split(",")[0].match(/0/g)||[]).length;var p=String(f).match(/(0*)(?:\[(0*)\])?/);if(p){a.minDecimals=p[1].length;a.maxDecimals=a.minDecimals+(p[2]||"").length}else{a.minDecimals=0;a.maxDecimals=0}return t.fromJS(a)};t.fromJS=function(e){if(typeof e==="string"){var a=t.fromNumeralFormat(e);if(!a)a=t.fromNumeralFormat("0,0.00 a");return a}return new t(immutable_class_1.BaseImmutable.jsToValue(t.PROPERTIES,e))};t.prototype.hasForceAbbreviation=function(){return this.forceAbbreviation!=null};t.prototype.getAbbreviationScale=function(){var e=this.type;if(e==="byte"||e==="byte-iec"||e==="bit-per-second"||e==="bit-per-second-iec")return 1024;return 1e3};t.prototype.getAbbreviations=function(){switch(this.type){case"si":return t.SI_ABBREVIATIONS;case"dollar":return["","k","M","B","T"];case"byte":return["B","KB","MB","GB","TB","PB","EB","ZB","YB"];case"byte-decimal":return["B","kB","MB","GB","TB","PB","EB","ZB","YB"];case"byte-iec":return["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"];case"bit-per-second":return["bps","Kbps","Mbps","Gbps","Tbps","Pbps","Ebps","Zbps","Ybps"];case"bit-per-second-decimal":return["bps","kbps","Mbps","Gbps","Tbps","Pbps","Ebps","Zbps","Ybps"];case"bit-per-second-iec":return["bps","Kibps","Mibps","Gibps","Tibps","Pibps","Eibps","Zibps","Yibps"];case"millisecond":return["ms","sec","Ksec","Msec","Bsec"];case"percent":return["%"];default:return[""]}};t.prototype.format=function(e){if(isNaN(e)||!isFinite(e))return"-";var a=this.type;e=e||0;if(a==="duration")return t.formatDuration(e);if(a==="duration-ago")return t.formatDuration(t.now()-e);if(a==="percent")e*=100;var i;if(a==="dollar"||a==="dollar-raw"){i="$"+this.formatAbsolute(e)}else if(a==="seconds-as-time"){i=t.formatSeconds(e)}else{i=this.formatAbsolute(e)}return this.applySign(i,e<0)};t.prototype.fixForValue=function(e){if(this.hasForceAbbreviation())return this;return this.changeForceAbbreviation(this.getAbbreviationPowerForAbsValue(Math.abs(e)))};t.prototype.fixForValues=function(e){return this.fixForValue(t.getMiddleNonZeroNumber(e))};t.prototype.getAbbreviationPowerForAbsValue=function(e){var a=this.getAbbreviationScale();var i=this.getAbbreviations();var r=0;if(this.getForceAbbreviation()!=null){r=this.getForceAbbreviation()}else if(this.getType()!=="raw"){r=t.logScale(e,a)}return Math.min(r,i.length-1)};t.prototype.formatAbsolute=function(e){e=Math.abs(e);if(this.getInteger()){e=Math.round(e)}var a=this.getAbbreviationPowerForAbsValue(e);if(a){e=e/Math.pow(this.getAbbreviationScale(),a)}var i=this.getMinDecimals();var r=this.getMaxDecimals();if(this.getInteger()){i=Math.min(i,a*3);r=Math.min(r,a*3)}var n=this.getLeading();var s=r-i;e=Math.round(t.scalePowTen(e,r));var l="";for(var o=-r;0<e||o<n;o++){if(o>0&&o%3===0&&l){l=this.getThousandsDelimiter()+l}var u=e%10;e=Math.trunc(e/10);if(s<=0||u!==0){l=u+l}s--;if(o===-1){if(l&&Number(l)===0&&this.getOptionalDecimal())l="";if(l)l=this.getDecimalDelimiter()+l}}var b=this.getAbbreviations()[a]||this.getRawUnit()||"";if(b&&this.getAbbreviationSpace()){l+=" "}l+=b;return l};t.prototype.applySign=function(e,t){var a=this.getNegativeParentheses();if(a){return(t?"(":"")+e+(t?")":"")}else{if(this.getSigned()){return(t?"-":"+")+e}else{return(t?"-":"")+e}}};t.DEFAULT_THOUSANDS_DELIMITER=",";t.DEFAULT_DECIMAL_DELIMITER=".";t.SI_ABBREVIATIONS=["","k","m","b","t"];t.PROPERTIES=[{name:"type",defaultValue:"raw"},{name:"leading",defaultValue:1,validate:immutable_class_1.BaseImmutable.ensure.nonNegative},{name:"minDecimals",defaultValue:1,validate:immutable_class_1.BaseImmutable.ensure.nonNegative},{name:"maxDecimals",defaultValue:1,validate:immutable_class_1.BaseImmutable.ensure.nonNegative},{name:"optionalDecimal",defaultValue:false},{name:"negativeParentheses",defaultValue:false},{name:"signed",defaultValue:false},{name:"integer",defaultValue:false},{name:"thousandsDelimiter",defaultValue:t.DEFAULT_THOUSANDS_DELIMITER},{name:"decimalDelimiter",defaultValue:t.DEFAULT_DECIMAL_DELIMITER},{name:"customZero",defaultValue:null},{name:"customNull",defaultValue:null},{name:"forceAbbreviation",defaultValue:null},{name:"abbreviationSpace",defaultValue:false},{name:"rawUnit",defaultValue:null}];return t}(immutable_class_1.BaseImmutable);exports.NumberStyle=NumberStyle;immutable_class_1.BaseImmutable.finalize(NumberStyle);