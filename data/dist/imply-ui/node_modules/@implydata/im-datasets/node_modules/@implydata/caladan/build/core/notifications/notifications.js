"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tslib_1=require("tslib");var React=require("react");var ReactDOM=require("react-dom");var classNames=require("classnames");var immutable_class_1=require("immutable-class");var body_portal_1=require("../body-portal/body-portal");var button_1=require("../button/button");var loading_bar_1=require("../loading-bar/loading-bar");var modal_1=require("../modal/modal");var notification_card_1=require("../notification-card/notification-card");var notifier_1=require("../notifier/notifier");function isPromiseAlike(e){return Boolean(e&&typeof e.then==="function")}var Notifications=function(e){tslib_1.__extends(t,e);function t(){var t=e.call(this)||this;t.onChange=function(e){t.setState({notifications:e})};t.state={notifications:[]};return t}t.prototype.componentDidMount=function(){notifier_1.Notifier.subscribe(this.onChange)};t.prototype.componentWillUnmount=function(){notifier_1.Notifier.unsubscribe(this.onChange)};t.prototype.renderCards=function(){var e=13;return this.state.notifications.map(function(t,a){var i=t.title,n=t.message,r=t.action;var o=e;e+=[i,n,r].filter(Boolean).length*30+5;return React.createElement(notification_card_1.NotificationCard,{model:t,key:t.id,top:o})})};t.prototype.render=function(){return React.createElement(body_portal_1.BodyPortal,{left:"50%",top:"10px",isAboveAll:true},React.createElement("div",{className:"notifications"},this.renderCards()))};return t}(React.Component);exports.Notifications=Notifications;var Questions=function(e){tslib_1.__extends(t,e);function t(){var t=e.call(this)||this;t.onChange=function(e,a){t.setState({question:a})};t.renderButton=function(e,a){var i=t.state,n=i.loadingMessages,r=i.question;var o=e.label,s=e.callback,l=e.type,c=e.className,u=e.closeOnClick,m=e.loadingMessage;var f=function(e){if(!e||l!=="primary")return;ReactDOM.findDOMNode(e).focus()};var d=r.id||r.title;var _=function(){if(u)notifier_1.Notifier.removeQuestion();if(s){var e=s();if(isPromiseAlike(e)){var a={name:d,message:m||""};t.setState({loadingMessages:immutable_class_1.NamedArray.overrideByName(n,a)});e.then(function(){return t.setState({loadingMessages:immutable_class_1.NamedArray.overrideByName(n,{name:d,message:null})})})}}};return React.createElement(button_1.Button,{key:a,className:c,title:o,type:l,disabled:immutable_class_1.NamedArray.findByName(n,d)!=null,onClick:_,ref:f})};t.state={loadingMessages:[]};return t}t.prototype.componentDidMount=function(){notifier_1.Notifier.subscribe(this.onChange)};t.prototype.componentWillUnmount=function(){notifier_1.Notifier.unsubscribe(this.onChange)};t.prototype.render=function(){var e=this.state,t=e.question,a=e.loadingMessages;if(!t)return null;var i;if(Array.isArray(t.message)){i=t.message.map(function(e,t){return React.createElement("p",{key:t},e)})}else if(React.isValidElement(t.message)){i=t.message}else{i=React.createElement("p",null,t.message)}var n=immutable_class_1.NamedArray.findByName(a,t.id||t.title);return React.createElement(modal_1.Modal,{className:classNames("question",t.className),title:t.title,onClose:t.onClose},i,React.createElement("div",{className:"button-bar"},n!=null?React.createElement(loading_bar_1.LoadingBar,{label:n.message}):t.choices.map(this.renderButton)))};return t}(React.Component);exports.Questions=Questions;