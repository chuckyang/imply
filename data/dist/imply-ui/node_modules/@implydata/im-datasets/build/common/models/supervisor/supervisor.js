"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tslib_1=require("tslib");var immutable_class_1=require("immutable-class");function calculateTaskRate(task){var startTime=task.startTime,startingOffsets=task.startingOffsets,currentOffsets=task.currentOffsets;if(!startingOffsets)return"-";var timeDiff=(Date.now()-new Date(startTime).valueOf())/1e3;var firstOffset=Object.keys(startingOffsets)[0];var val1=startingOffsets[firstOffset];var val2=currentOffsets[firstOffset];var valueDiff=val2-val1;return valueDiff/timeDiff}exports.calculateTaskRate=calculateTaskRate;var Supervisor=function(_super){tslib_1.__extends(Supervisor,_super);function Supervisor(params){return _super.call(this,params)||this}Supervisor.fromSupervisorHistoryAndStatus=function(params){var history=params.history,status=params.status,id=params.id,connectionName=params.connectionName,connectionTitle=params.connectionTitle;var js={id:id,connectionName:connectionName,connectionTitle:connectionTitle};var lastHistory=(history||[]).find(function(h){return!!h.spec});var lastAlive=(history||[]).find(function(h){return!!h.spec&&h.spec.type!==Supervisor.TOMBSTONE});if(lastHistory){var spec=lastHistory.spec;if(spec){js.isAlive=spec.type!==Supervisor.TOMBSTONE}if(lastAlive&&lastAlive.spec){js.spec=lastAlive.spec;js.type=lastAlive.spec.type}}if(status){var payload=status.payload,generationTime=status.generationTime;js.generationTime=generationTime;if(payload){var activeTasks=payload.activeTasks,publishingTasks=payload.publishingTasks,topic=payload.topic,stream=payload.stream,partitions=payload.partitions,replicas=payload.replicas;js.tasks=activeTasks.concat(publishingTasks);js.topic=topic;js.partitions=partitions;js.replicas=replicas;js.stream=stream}}return Supervisor.fromJS(js)};Supervisor.fromJS=function(params){return new Supervisor(immutable_class_1.BaseImmutable.jsToValue(Supervisor.PROPERTIES,params))};Supervisor.prototype.getDataSource=function(){return this.id};Supervisor.prototype.getTopicOrStream=function(){return this.stream||this.topic||"-"};Supervisor.prototype.isStopped=function(){return!this.isAlive};Supervisor.TOMBSTONE="NoopSupervisorSpec";Supervisor.PROPERTIES=[{name:"id"},{name:"connectionName"},{name:"connectionTitle",defaultValue:null},{name:"type",defaultValue:null},{name:"stream",defaultValue:null},{name:"topic",defaultValue:null},{name:"generationTime",defaultValue:null,type:immutable_class_1.PropertyType.DATE},{name:"partitions",defaultValue:null},{name:"replicas",defaultValue:null},{name:"isAlive",defaultValue:false},{name:"tasks",defaultValue:[],equal:function(a,b){return JSON.stringify(a)===JSON.stringify(b)}},{name:"spec",defaultValue:null,equal:function(a,b){return JSON.stringify(a)===JSON.stringify(b)}}];return Supervisor}(immutable_class_1.BaseImmutable);exports.Supervisor=Supervisor;immutable_class_1.BaseImmutable.finalize(Supervisor);