"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tslib_1=require("tslib");require("./datasets-view.css");var React=require("react");var immutable_class_1=require("immutable-class");var Icons=require("@implydata/little-pictures");var ajax_1=require("@implydata/ajax");var beltful_1=require("@implydata/beltful");var caladan_1=require("@implydata/caladan");var imply_ui_common_1=require("@implydata/imply-ui-common");var index_1=require("../../../common/models/index");var index_2=require("../../../common/models/index");var index_3=require("../../../common/models/index");var data_loader_helper_1=require("../../../common/models/data-loader-helper/data-loader-helper");var data_source_edit_1=require("../../components/data-source-edit/data-source-edit");var data_loader_1=require("../../components/data-loader/data-loader");var ingestion_type_selection_1=require("../../components/ingestion-type-selection/ingestion-type-selection");var json_data_loader_1=require("../../components/json-data-loader/json-data-loader");var query_error_1=require("../../components/query-error/query-error");var data_sources_table_1=require("../../components/data-sources-table/data-sources-table");var datasets_header_bar_1=require("../../components/datasets-header-bar/datasets-header-bar");var sub_header_bar_1=require("../../components/sub-header-bar/sub-header-bar");var strings_1=require("../../../common/utils/constants/strings");var POLLING_INTERVAL=6e4;var DatasetsView=function(_super){tslib_1.__extends(DatasetsView,_super);function DatasetsView(){var _this=_super.call(this)||this;_this.loadDataSources=function(isPoll){if(isPoll===void 0){isPoll=false}return tslib_1.__awaiter(_this,void 0,void 0,function(){var taskId,loadedDataSources,url,datasourceResponse,dataSources,tasks,task,e_1;return tslib_1.__generator(this,function(_a){switch(_a.label){case 0:taskId=this.props.taskId;url="$mount/datasource/load";_a.label=1;case 1:_a.trys.push([1,3,,4]);return[4,ajax_1.Ajax.query({url:url,data:{isPoll:isPoll,priorities:this.getRefreshPriorities()}})];case 2:datasourceResponse=_a.sent();if(!datasourceResponse)throw new Error("Empty response");dataSources=datasourceResponse.dataSources;if(!dataSources)throw new Error("No datasources");loadedDataSources=dataSources.map(index_1.Dataset.fromJS);if(taskId){tasks=[].concat.apply([],loadedDataSources.map(function(d){return d.getTasks()}));task=tasks.find(function(t){return t.taskId===taskId});if(!task){caladan_1.Notifier.failure("Could not rerun task");return[2]}this.setRerunInfo(task)}return[3,4];case 3:e_1=_a.sent();if(!this.mounted)return[2];this.setState({datasetsQueryError:new Error("Could not load datasets: "+e_1.message)});return[2];case 4:this.setState({dataSources:index_1.Dataset.mergeDataSources(this.state.dataSources,loadedDataSources),datasetsQueryError:null});return[2]}})})};_this.loadConnections=function(){return tslib_1.__awaiter(_this,void 0,void 0,function(){var connections,url,connectionsResponse,e_2;return tslib_1.__generator(this,function(_a){switch(_a.label){case 0:url="$mount/connection/load";_a.label=1;case 1:_a.trys.push([1,3,,4]);return[4,ajax_1.Ajax.query({url:url})];case 2:connectionsResponse=_a.sent();if(!connectionsResponse||!Array.isArray(connectionsResponse.connections))throw new Error("Empty response");connections=connectionsResponse.connections.map(imply_ui_common_1.Connection.fromJS);return[3,4];case 3:e_2=_a.sent();if(!this.mounted)return[2];this.setState({datasetsQueryError:new Error("Could not load datasets: "+e_2.message)});return[2];case 4:this.setState({connections:connections,dataLoaderHelper:this.state.dataLoaderHelper.changeConnections(connections)});return[2]}})})};_this.startSupervisor=function(dataSource){var supervisor=dataSource.supervisor;var connectionName=supervisor.connectionName,id=supervisor.id;var callback=function(){return tslib_1.__awaiter(_this,void 0,void 0,function(){var supervisorsResp,e_3;return tslib_1.__generator(this,function(_a){switch(_a.label){case 0:_a.trys.push([0,2,,3]);return[4,ajax_1.Ajax.query({url:"$mount/supervisor/restart",data:{connectionName:connectionName,supervisor:supervisor}})];case 1:supervisorsResp=_a.sent();this.handleSupervisorsResponse(supervisorsResp);caladan_1.Notifier.removeQuestion();return[3,3];case 2:e_3=_a.sent();caladan_1.Notifier.removeQuestion();caladan_1.Notifier.failure("Could not shutdown supervisor",e_3.message);return[2];case 3:return[2]}})})};return caladan_1.Notifier.ask({id:"start-supervisor-"+id+"-"+new Date,title:"Start supervisor",message:"Are you sure you want to start '"+id+"'?",choices:[{label:"No",closeOnClick:true,type:"secondary"},{label:"Yes",closeOnClick:false,type:"primary",callback:callback,loadingMessage:"Starting..."}],onClose:caladan_1.Notifier.removeQuestion})};_this.stopSupervisor=function(dataSource){var supervisor=dataSource.supervisor;var connectionName=supervisor.connectionName,id=supervisor.id;var callback=function(){return tslib_1.__awaiter(_this,void 0,void 0,function(){var supervisorsResp,e_4;return tslib_1.__generator(this,function(_a){switch(_a.label){case 0:_a.trys.push([0,2,,3]);return[4,ajax_1.Ajax.query({url:"$mount/supervisor/shutdown",data:{connectionName:connectionName,supervisorId:id}})];case 1:supervisorsResp=_a.sent();this.handleSupervisorsResponse(supervisorsResp);caladan_1.Notifier.removeQuestion();return[3,3];case 2:e_4=_a.sent();caladan_1.Notifier.removeQuestion();caladan_1.Notifier.failure("Could not shutdown supervisor",e_4.message);return[2];case 3:return[2]}})})};return caladan_1.Notifier.ask({id:"shutdown-supervisor-"+id+"-"+new Date,title:"Stop supervisor",message:"Are you sure you want to stop '"+id+"'?",choices:[{label:"No",closeOnClick:true,type:"secondary"},{label:"Yes",closeOnClick:false,type:"primary",callback:callback,loadingMessage:"Shutting down..."}],onClose:caladan_1.Notifier.removeQuestion})};_this.onOnboardClick=function(){_this.mountAndGo("load-data")};_this.state={dataLoaderHelper:new data_loader_helper_1.DataLoaderHelper({})};return _this}DatasetsView.prototype.handleSupervisorsResponse=function(supervisorResponse){var dataSources=this.state.dataSources;if(!supervisorResponse||!Array.isArray(supervisorResponse.supervisors)){this.setState({supervisorsQueryError:new Error("Empty response")});return{supervisorsQueryError:new Error("Empty response")}}var supervisors;var updatedDataSources;try{supervisors=supervisorResponse.supervisors.map(function(supervisorJS){return index_2.Supervisor.fromJS(supervisorJS)})}catch(e){return{supervisorsQueryError:new Error("Could not load supervisors: "+e.message)}}if(dataSources&&supervisors){updatedDataSources=supervisors.map(function(supervisor){var correspondingDataSource=dataSources.find(function(d){return d.name===supervisor.id});if(!correspondingDataSource){return index_1.Dataset.fromSupervisor(supervisor)}return correspondingDataSource.changeSupervisor(supervisor)}).filter(Boolean)}var newState={supervisorsQueryError:null};if(updatedDataSources&&updatedDataSources.length){newState.dataSources=updatedDataSources}return newState};DatasetsView.prototype.editSupervisor=function(spec,connectionName,onError){var _this=this;var dataLoaderHelper=this.state.dataLoaderHelper;var supervisorsResp;var callback=function(){return tslib_1.__awaiter(_this,void 0,void 0,function(){var _this=this;var e_5;return tslib_1.__generator(this,function(_a){switch(_a.label){case 0:_a.trys.push([0,2,,3]);return[4,ajax_1.Ajax.query({url:"$mount/supervisor/edit",data:{connectionName:connectionName,supervisor:spec.toSupervisorSpec()}})];case 1:supervisorsResp=_a.sent();this.setState(tslib_1.__assign({},this.handleSupervisorsResponse(supervisorsResp),{dataLoaderHelper:dataLoaderHelper.clearThings()}),function(){caladan_1.Notifier.removeQuestion();_this.mountAndGo([connectionName,spec.dataSource])});return[3,3];case 2:e_5=_a.sent();caladan_1.Notifier.removeQuestion();if(onError){onError(e_5)}else{caladan_1.Notifier.failure("Sorry","The supervisor couldn't be edited "+e_5.message)}return[3,3];case 3:return[2]}})})};return caladan_1.Notifier.ask({id:"edit-supervisor-"+Date.now(),title:"Edit supervisor spec?",message:"Are you sure you want to edit this supervisor?",choices:[{label:"Cancel",closeOnClick:true,type:"secondary"},{label:"Submit",closeOnClick:false,type:"primary",callback:callback,loadingMessage:"Submitting..."}],onClose:caladan_1.Notifier.removeQuestion})};DatasetsView.prototype.getRefreshPriorities=function(){var lastEventTimeMaxLength=this.props.lastEventTimeMaxLength;var dataSources=this.state.dataSources;if(!dataSources)return null;var prioritySortOrder=["highest","high","low","lowest"];var OLD_DATA_REFRESH_CHANGE=.1;var sortedPriorities=dataSources.map(function(d){var priority=index_1.Dataset.getPollLastEventPriority(d.lastEventTime);var priorityObj={connectionName:d.connectionName,dataSource:d.name,priority:priority};var myRandom=Math.random();if(priority==="lowest"){return myRandom<=OLD_DATA_REFRESH_CHANGE?priorityObj:null}return priorityObj}).filter(Boolean).sort(function(d1,d2){var p1=d1.priority;var p2=d2.priority;if(p1!==p2){return prioritySortOrder.indexOf(p1)-prioritySortOrder.indexOf(p2)}return 1});return sortedPriorities.slice(0,lastEventTimeMaxLength)};DatasetsView.prototype.shutdownTask=function(task){var _this=this;var taskId=task.taskId;var callback=function(){return tslib_1.__awaiter(_this,void 0,void 0,function(){var e_6;return tslib_1.__generator(this,function(_a){switch(_a.label){case 0:_a.trys.push([0,2,,3]);return[4,ajax_1.Ajax.query({url:"$mount/task/shutdown",data:{connectionName:task.connectionName,id:taskId}})];case 1:_a.sent();return[3,3];case 2:e_6=_a.sent();caladan_1.Notifier.removeQuestion();caladan_1.Notifier.failure("Could not cancel task",e_6.message);return[2];case 3:this.loadDataSources();caladan_1.Notifier.removeQuestion();return[2]}})})};return caladan_1.Notifier.ask({id:"cancel-task-"+taskId,title:"Cancel Task",message:"Are you sure you want to cancel '"+task.taskId+"'?",choices:[{label:"No",closeOnClick:true,type:"secondary"},{label:"Yes",closeOnClick:false,type:"primary",callback:callback,loadingMessage:"Cancelling..."}],onClose:caladan_1.Notifier.removeQuestion})};DatasetsView.prototype.createDataSourceFromWizard=function(spec,connectionName,onError){return tslib_1.__awaiter(this,void 0,void 0,function(){var dataLoaderHelper,dataSource,supportsPrefixes,url,dataSources,dataSourceJses,e_7;return tslib_1.__generator(this,function(_a){switch(_a.label){case 0:dataLoaderHelper=this.state.dataLoaderHelper;dataSource=spec.getDataSource();supportsPrefixes=this.getCapabilities(connectionName).supportsPrefixes();url="$mount/task/create";_a.label=1;case 1:_a.trys.push([1,3,,4]);return[4,ajax_1.Ajax.query({url:url,data:{connectionName:connectionName,task:spec.toIngestionSpec(supportsPrefixes),dataSource:dataSource}})];case 2:dataSourceJses=_a.sent();dataSources=dataSourceJses?dataSourceJses.dataSources.map(function(js){return index_1.Dataset.fromJS(js)}):[];return[3,4];case 3:e_7=_a.sent();onError(e_7);return[2];case 4:caladan_1.Notifier.removeQuestion();this.setState({dataLoaderHelper:dataLoaderHelper.clearThings(),dataSources:dataSources});this.mountAndGo([connectionName,dataSource]);return[2]}})})};DatasetsView.prototype.createDataSourceNonWizard=function(spec,connectionName,onError){var _this=this;var dataLoaderHelper=this.state.dataLoaderHelper;var dataSource=spec.getDataSource();var isSupervised=spec.isSupervised();var url=isSupervised?"$mount/supervisor/create":"$mount/task/create";var thingName=isSupervised?"supervisor":"task";var dataSourceName=spec.getDataSource();var supportsPrefixes=this.getCapabilities(connectionName).supportsPrefixes();var callback=function(){return tslib_1.__awaiter(_this,void 0,void 0,function(){var _this=this;var state,dataSourceJses,e_8;return tslib_1.__generator(this,function(_a){switch(_a.label){case 0:state={};_a.label=1;case 1:_a.trys.push([1,3,,4]);return[4,ajax_1.Ajax.query({url:url,data:{connectionName:connectionName,task:index_3.DataLoaderSpec.isDataLoaderSpec(spec)?spec.toIngestionSpec(supportsPrefixes):spec.toBatchJSONSpec(),dataSource:dataSource}})];case 2:dataSourceJses=_a.sent();if(dataSourceJses.supervisors){state=this.handleSupervisorsResponse(dataSourceJses)}else{state.dataSources=dataSourceJses?dataSourceJses.dataSources.map(function(js){return index_1.Dataset.fromJS(js)}):[]}return[3,4];case 3:e_8=_a.sent();caladan_1.Notifier.removeQuestion();if(onError){onError(e_8)}else{caladan_1.Notifier.failure("Sorry","The "+thingName+" couldn't be posted "+e_8.message)}return[2];case 4:caladan_1.Notifier.removeQuestion();state.dataLoaderHelper=dataLoaderHelper.clearThings();this.setState(state,function(){_this.mountAndGo([connectionName,dataSourceName])});return[2]}})})};return caladan_1.Notifier.ask({id:"create-spec-"+dataSource+"-"+isSupervised+"-"+Date.now(),title:"Submit "+thingName+" for "+spec.getDataSource()+"?",message:"Are you sure you want to submit this "+thingName+"?",choices:[{label:"Cancel",closeOnClick:true,type:"secondary"},{label:"Submit",closeOnClick:false,type:"primary",callback:callback,loadingMessage:"Submitting..."}],onClose:caladan_1.Notifier.removeQuestion})};DatasetsView.prototype.onEditDataSourceClick=function(dataSource){this.mountAndGo([dataSource.connectionName,dataSource.name])};DatasetsView.prototype.removeDataSource=function(name,connectionName,callback){return tslib_1.__awaiter(this,void 0,void 0,function(){var _this=this;var remove;return tslib_1.__generator(this,function(_a){remove=function(){return tslib_1.__awaiter(_this,void 0,void 0,function(){var dataSources,dataSourcesJSes,e_9;return tslib_1.__generator(this,function(_a){switch(_a.label){case 0:_a.trys.push([0,2,,3]);return[4,ajax_1.Ajax.query({url:"$mount/datasource/delete",data:{datasetName:name,connectionName:connectionName}})];case 1:dataSourcesJSes=_a.sent();if(!dataSourcesJSes){caladan_1.Notifier.failure("Empty response");return[2]}dataSources=dataSourcesJSes.dataSources.map(function(d){return index_1.Dataset.fromJS(d)});return[3,3];case 2:e_9=_a.sent();caladan_1.Notifier.removeQuestion();caladan_1.Notifier.failure("Could not delete data set",e_9.message);return[2];case 3:this.setState({dataSources:dataSources},function(){if(callback)callback()});caladan_1.Notifier.removeQuestion();return[2]}})})};return[2,caladan_1.Notifier.ask({id:"delete-datasource-"+name,title:"Delete dataset",message:"Are you sure you want to delete '"+name+"'?",choices:[{label:"No",closeOnClick:true,type:"secondary"},{label:"Yes",closeOnClick:false,type:"primary",callback:remove,loadingMessage:"Deleting..."}],onClose:caladan_1.Notifier.removeQuestion})]})})};DatasetsView.prototype.componentDidMount=function(){this.mounted=true;this.loadDataSources(false);this.loadConnections();this.interval=setInterval(this.loadDataSources.bind(this,true),POLLING_INTERVAL);this.setState({dataLoaderHelper:new data_loader_helper_1.DataLoaderHelper({connections:this.state.connections||[]})})};DatasetsView.prototype.componentWillReceiveProps=function(props){var _a=this.state,dataLoaderHelper=_a.dataLoaderHelper,connections=_a.connections;this.setState({dataLoaderHelper:dataLoaderHelper.changeConnections(connections)})};DatasetsView.prototype.componentWillUnmount=function(){this.mounted=false};DatasetsView.prototype.onURLChange=function(breadCrumbs){this.setState({breadCrumbs:breadCrumbs})};DatasetsView.prototype.mountAndGo=function(path){window.history.pushState({},"",beltful_1.MountPoint.mount(path))};DatasetsView.prototype.backFromDataSourceView=function(){this.mountAndGo("")};DatasetsView.prototype.updateDataLoaderHelper=function(dataLoaderHelper,callback){if(callback===void 0){callback=function(){}}this.setState({dataLoaderHelper:dataLoaderHelper},function(){return callback()})};DatasetsView.prototype.backFromDataLoaderView=function(){var dataLoaderHelper=this.state.dataLoaderHelper;this.updateDataLoaderHelper(dataLoaderHelper.clearThings());this.mountAndGo("")};DatasetsView.prototype.getAllCapabilities=function(){var connections=this.state.connections;if(!connections)return imply_ui_common_1.Capabilities.EMPTY;var allCapabilities=imply_ui_common_1.Capabilities.EMPTY;connections.forEach(function(c){allCapabilities=allCapabilities.addCapabilities(c.getCapabilities())});return allCapabilities};DatasetsView.prototype.onOnboardTypeClick=function(ingestionType,exampleName){var dataLoaderHelper=this.state.dataLoaderHelper;this.updateDataLoaderHelper(dataLoaderHelper.setIngestionType(ingestionType,exampleName))};DatasetsView.prototype.backFromMenuSelector=function(){var _this=this;var dataLoaderHelper=this.state.dataLoaderHelper;this.updateDataLoaderHelper(dataLoaderHelper.clearThings(),function(){return _this.mountAndGo("")})};DatasetsView.prototype.setRerunInfo=function(toRerun){var _this=this;var dataLoaderHelper=this.state.dataLoaderHelper;this.updateDataLoaderHelper(dataLoaderHelper.setRerunInfo(toRerun),function(){return _this.mountAndGo("load-data")})};DatasetsView.prototype.fallbackToJSONTask=function(spec,connectionName){var _this=this;var dataLoaderHelper=this.state.dataLoaderHelper;var supportsPrefixes=this.getCapabilities(connectionName).supportsPrefixes();this.updateDataLoaderHelper(dataLoaderHelper.fallbackToJSON(spec.toFallbackJSONSpec(supportsPrefixes,connectionName)),function(){return _this.mountAndGo("load-data")})};DatasetsView.prototype.getCapabilities=function(connectionName){var connections=this.state.connections;if(!connections)return imply_ui_common_1.Capabilities.EMPTY;var connection=connections.find(function(cm){return cm.name===connectionName});if(!connection)return imply_ui_common_1.Capabilities.EMPTY;return connection.getCapabilities()};DatasetsView.prototype.renderDataSources=function(){var _this=this;var _a=this.state,dataSources=_a.dataSources,datasetsQueryError=_a.datasetsQueryError,connections=_a.connections;if(datasetsQueryError)return React.createElement("div",{className:"panel"},React.createElement(query_error_1.QueryError,{error:datasetsQueryError}));if(!connections&&!datasetsQueryError)return React.createElement("div",{className:"panel"},React.createElement(caladan_1.Loader,null));return React.createElement("div",{className:"data-sources panel"},React.createElement("div",{className:"title-bar"},React.createElement("div",{className:"title"},"Datasets")),React.createElement(data_sources_table_1.DataSourcesTable,{className:"tabless-content",dataSources:dataSources,onEditClick:function(d){return _this.onEditDataSourceClick(d)},removeDataSource:function(d){return _this.removeDataSource(d.name,d.connectionName)},connections:connections}))};DatasetsView.prototype.renderDataLoaderRoute=function(){var _this=this;var exampleDatasets=this.props.exampleDatasets;var _a=this.state,dataLoaderHelper=_a.dataLoaderHelper,dataSources=_a.dataSources;var onSubmitFromJSON=function(spec,clusterId,onError){dataLoaderHelper.isSupervisorEdit()?_this.editSupervisor(spec,clusterId,onError):_this.createDataSourceNonWizard(spec,clusterId,onError)};return dataLoaderHelper.shouldShowWizard()?React.createElement(data_loader_1.DataLoader,{dataLoaderHelper:dataLoaderHelper.setConnectionsForWizard(),dataSources:dataSources||[],onSubmit:function(spec,connection,onError){_this.createDataSourceFromWizard(spec,connection,onError)},back:function(){return _this.backFromDataLoaderView()},exampleDatasets:exampleDatasets,fallbackToJSONTask:function(spec,connectionName){return _this.fallbackToJSONTask(spec,connectionName)}}):React.createElement(json_data_loader_1.JSONDataLoader,{dataLoaderHelper:dataLoaderHelper.setConnectionsForJSONLoader(),onSubmit:onSubmitFromJSON,back:function(){return _this.backFromDataLoaderView()},dataSources:dataSources||[],exampleDatasets:exampleDatasets})};DatasetsView.prototype.renderIngestionTypeSelection=function(){var _this=this;var _a=this.props,supportsLocalFileUpload=_a.supportsLocalFileUpload,exampleDatasets=_a.exampleDatasets;var dataLoaderHelper=this.state.dataLoaderHelper;return React.createElement(ingestion_type_selection_1.IngestionTypeSelection,{onOnboardClick:function(ingestionType,exampleName){return _this.onOnboardTypeClick(ingestionType,exampleName)},back:function(){return _this.backFromMenuSelector()},getCapabilities:function(cluster){return _this.getAllCapabilities()},supportsLocalFileUpload:supportsLocalFileUpload,exampleDatasets:exampleDatasets,browserBack:function(){_this.updateDataLoaderHelper(dataLoaderHelper.clearThings())}})};DatasetsView.prototype.render=function(){var _this=this;var user=this.props.user;var _a=this.state,dataSources=_a.dataSources,supervisorsQueryError=_a.supervisorsQueryError,drawerOpen=_a.drawerOpen,breadCrumbs=_a.breadCrumbs,dataLoaderHelper=_a.dataLoaderHelper,connections=_a.connections;var getValue=function(value){if(!breadCrumbs)return null;var connection=breadCrumbs[0];return immutable_class_1.SimpleArray.find(dataSources,function(d){return d.name===value&&d.connectionName===connection})};var getDataSource=function(connectionName,dataSourceName){return immutable_class_1.SimpleArray.find(dataSources||[],function(d){return d.name===dataSourceName&&d.connectionName===connectionName})};return React.createElement("div",{className:"datasets-view"},React.createElement(datasets_header_bar_1.DatasetsHeaderBar,{mainSvg:Icons.FUTURA_DATA_CUBES,title:strings_1.STRINGS.implyManager,user:user,onNavClick:function(){return _this.setState({drawerOpen:true})},logoutHref:imply_ui_common_1.Compass.getInstance().getLogoutHref()}),React.createElement(sub_header_bar_1.SubHeaderBar,{onOnboardClick:breadCrumbs&&breadCrumbs.includes("load-data")?null:this.onOnboardClick,canOnBoard:connections?!!connections.find(function(cm){return!!cm.canOnboardData()}):false}),React.createElement("div",{className:"outer-drawer-container"},React.createElement(caladan_1.SideDrawer,{open:drawerOpen,showSearch:true,items:imply_ui_common_1.Compass.getInstance().getSideDrawerLinks(),onClose:function(){return _this.setState({drawerOpen:false})},navLogo:Icons.COMBO_LOGO})),React.createElement("div",{className:"main-panel"},React.createElement(caladan_1.StateRouter,{rootFragment:beltful_1.MountPoint.root,onURLChange:function(crumbs){return _this.onURLChange(crumbs)}},React.createElement(caladan_1.Route,{fragment:""},this.renderDataSources()),React.createElement(caladan_1.Route,{fragment:"load-data"},dataLoaderHelper.knowIngestionType()?this.renderDataLoaderRoute():this.renderIngestionTypeSelection()),React.createElement(caladan_1.Route,{fragment:":connectionName/:dataSourceName",renderer:function(v){var dataSource=getDataSource(v.connectionName,v.dataSourceName);return React.createElement(data_source_edit_1.DataSourceEdit,{dataSource:dataSource,back:function(){return _this.backFromDataSourceView()},shutdownTask:function(task){return _this.shutdownTask(task)},rerunTask:function(task){return _this.setRerunInfo(task)},supervisorsQueryError:supervisorsQueryError,onEditSupervisorClick:function(d){_this.updateDataLoaderHelper(dataLoaderHelper.setSupervisorEditInfo(d),function(){return _this.mountAndGo("load-data")})},onStartSupervisorClick:_this.startSupervisor,onStopSupervisorClick:_this.stopSupervisor,onLoadDataClick:function(d){return _this.setRerunInfo(d)},onDeleteDataSourceClick:function(d,cb){_this.removeDataSource(d.name,d.connectionName,cb)}})}})),React.createElement(caladan_1.Notifications,null),React.createElement(caladan_1.Questions,null)))};return DatasetsView}(React.Component);exports.DatasetsView=DatasetsView;