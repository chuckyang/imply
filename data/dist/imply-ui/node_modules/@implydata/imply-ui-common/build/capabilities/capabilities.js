"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tslib_1=require("tslib");var immutable_class_1=require("immutable-class");var SAMPLER_NAME="io.druid.parsers.ParserRouteModule";var S3_STORAGE_NAME="io.druid.storage.s3.S3StorageDruidModule";var KINESIS_NAME="io.druid.indexing.kinesis.KinesisIndexingServiceModule";var Capabilities=function(_super){tslib_1.__extends(Capabilities,_super);function Capabilities(parameters){return _super.call(this,parameters)||this}Capabilities.isCapabilities=function(candidate){return candidate instanceof Capabilities};Capabilities.fromJS=function(parameters){return new Capabilities(immutable_class_1.BaseImmutable.jsToValue(Capabilities.PROPERTIES,parameters))};Capabilities.isVersionEqualOrAbove=function(v1,v2){var versionToArr=function(v){var beforeHyphen=v.split("-")[0];return beforeHyphen.split(".").map(function(v){return parseInt(v.replace(/\D/g,""),10)}).filter(function(v){return!isNaN(v)})};var versionArr=versionToArr(v1);var otherArr=versionToArr(v2);var bigger=false;for(var i=0;i<versionArr.length;i++){var n=versionArr[i];if(n>otherArr[i]){bigger=true;break}if(n<otherArr[i]){bigger=false;break}if(i===versionArr.length-1&&n===otherArr[i]){bigger=true;break}}return bigger};Capabilities.onboardInfofromDruidStatus=function(resp){var capabilities=[];var modules=resp.modules,version=resp.version;if(modules&&modules.find(function(m){return m.name===SAMPLER_NAME})){capabilities.push("sampling");capabilities.push("http-ingestion")}if(modules&&modules.find(function(m){return m.name===KINESIS_NAME})){capabilities.push("kinesis")}if(Capabilities.isVersionEqualOrAbove(version,"0.10.1")){capabilities.push("prefixes");capabilities.push("headers-ingestion")}return new Capabilities({capabilities:capabilities})};Capabilities.prototype.addCapability=function(c){var capabilities=this.capabilities;if(!capabilities)return this.changeCapabilities([c]);if(capabilities.includes(c))return this;return this.changeCapabilities(capabilities.concat(c))};Capabilities.prototype.addCapabilities=function(c){var capabilities=this.capabilities;var other=c.capabilities;if(!capabilities)return this.changeCapabilities(c.capabilities);if(!other)return this;return this.changeCapabilities(Array.from(new Set(capabilities.concat(other))))};Capabilities.prototype.supportsPrefixes=function(){var capabilities=this.capabilities;return capabilities&&capabilities.includes("prefixes")};Capabilities.prototype.supportsSampling=function(){var capabilities=this.capabilities;return capabilities&&capabilities.includes("sampling")};Capabilities.prototype.supportsHeaders=function(){var capabilities=this.capabilities;return capabilities&&capabilities.includes("headers-ingestion")};Capabilities.prototype.supportsLocalFileUpload=function(){var capabilities=this.capabilities;return capabilities&&capabilities.includes("local-file-upload")};Capabilities.prototype.supportsKinesis=function(){var capabilities=this.capabilities;return capabilities&&capabilities.includes("kinesis")};Capabilities.prototype.canOnboardData=function(){var capabilities=this.capabilities;return capabilities&&capabilities.includes("onboard-data")};Capabilities.prototype.canDeleteDatasets=function(){var capabilities=this.capabilities;return capabilities&&capabilities.includes("delete-datasets")};Capabilities.prototype.supportsHTTPIngestion=function(){var capabilities=this.capabilities;return capabilities&&capabilities.includes("http-ingestion")};Capabilities.PROPERTIES=[{name:"capabilities",defaultValue:[]},{name:"accountId",defaultValue:null},{name:"clusterName",defaultValue:null}];return Capabilities}(immutable_class_1.BaseImmutable);exports.Capabilities=Capabilities;immutable_class_1.BaseImmutable.finalize(Capabilities);Capabilities.EMPTY=Capabilities.fromJS({capabilities:[]});