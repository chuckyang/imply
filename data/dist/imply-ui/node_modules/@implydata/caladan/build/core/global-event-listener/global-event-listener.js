"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tslib_1=require("tslib");var beltful_1=require("@implydata/beltful");var uuid=require("uuid");var React=require("react");var KEY_CODES={ENTER:13,ESCAPE:27,LEFT:37,RIGHT:39};function enterKey(e){return e.which===KEY_CODES.ENTER}function escapeKey(e){return e.which===KEY_CODES.ESCAPE}function leftKey(e){return e.which===KEY_CODES.LEFT}function rightKey(e){return e.which===KEY_CODES.RIGHT}function alt(e){return e.altKey}var EVENTS=["resize","scroll","mousedown","mousemove","mouseup","touchstart","touchmove","touchend","touchcancel","click","keydown","keyup"];var GlobalEventListener=function(e){tslib_1.__extends(t,e);function t(){var o=e.call(this)||this;o.uuid=uuid.v4();o.propsToEvents={resize:"resize",scroll:"scroll",mouseDown:"mousedown",mouseMove:"mousemove",mouseUp:"mouseup",touchStart:"touchstart",touchMove:"touchmove",touchEnd:"touchend",touchCancel:"touchcancel",click:"click",keyDown:"keydown",keyUp:"keyup",altDown:"keydown",altUp:"keyup",enter:"keydown",escape:"keydown",right:"keydown",left:"keydown"};o.onClick=function(e){return o.props.click(e)};o.onResize=function(){return o.props.resize()};o.onScroll=function(e){return o.props.scroll(e)};o.onMousedown=function(e){return o.props.mouseDown(e)};o.onMousemove=function(e){return o.props.mouseMove(e)};o.onMouseup=function(e){return o.props.mouseUp(e)};o.onTouchstart=function(e){return o.props.touchStart(e)};o.onTouchmove=function(e){return o.props.touchMove(e)};o.onTouchend=function(e){return o.props.touchEnd(e)};o.onTouchcancel=function(e){return o.props.touchCancel(e)};o.onKeydown=function(e){if(o.props.escape&&escapeKey(e))o.props.escape(e);if(o.props.enter&&enterKey(e))o.props.enter(e);if(o.props.right&&rightKey(e))o.props.right(e);if(o.props.left&&leftKey(e))o.props.left(e);if(o.props.altDown&&alt(e)){o.isAltDown=true;o.props.altDown(e)}if(o.props.keyDown)o.props.keyDown(e)};o.onKeyup=function(e){if(o.props.altUp&&o.isAltDown){o.isAltDown=false;o.props.altUp(e)}if(o.props.keyUp)o.props.keyUp(e)};t.initialize();return o}t.initialize=function(){var e=this;if(this.initialized)return;EVENTS.forEach(function(t){var o=t==="scroll";window.addEventListener(t,function(o){return e.on(t,o)},o)});this.initialized=true};t.on=function(e,t){for(var o in this.subscriptions){if(this.subscriptions[o][e]){this.subscriptions[o][e](t)}}};t.subscribe=function(e,t,o){var n=this.subscriptions[e]||{};n[t]=o;this.subscriptions[e]=n};t.unsubscribe=function(e,t){var o=this.subscriptions[e]||{};delete o[t];this.subscriptions[e]=o};t.prototype.componentWillReceiveProps=function(e){this.refreshListeners(e,this.props)};t.prototype.componentDidMount=function(){this.refreshListeners(this.props)};t.prototype.componentWillUnmount=function(){for(var e in this.propsToEvents){this.removeListener(this.propsToEvents[e])}};t.prototype.refreshListeners=function(e,t){if(t===void 0){t={}}var o=[];var n=[];for(var r in this.propsToEvents){var i=this.propsToEvents[r];if(t[r]&&e[r])continue;if(e[r]&&o.indexOf(i)===-1){o.push(i)}else if(t[r]&&n.indexOf(i)===-1){n.push(i)}}n.forEach(this.removeListener,this);o.forEach(this.addListener,this)};t.prototype.addListener=function(e){var o=this.props.id;t.subscribe(o||this.uuid,e,this["on"+beltful_1.StringUtils.firstUp(e)])};t.prototype.removeListener=function(e){var o=this.props.id;t.unsubscribe(o||this.uuid,e)};t.prototype.render=function(){return null};t.defaultProps={useCaptureFor:["scroll"]};t.subscriptions={};t.initialized=false;return t}(React.Component);exports.GlobalEventListener=GlobalEventListener;