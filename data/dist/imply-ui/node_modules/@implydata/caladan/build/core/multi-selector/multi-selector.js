"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tslib_1=require("tslib");var React=require("react");var classNames=require("classnames");var button_1=require("../button/button");var modal_1=require("../modal/modal");var suggestions_list_1=require("../suggestions-list/suggestions-list");var caret_button_1=require("../caret-button/caret-button");var Icons=require("@implydata/little-pictures");var strings_1=require("../../strings");var MultiSelector=function(e){tslib_1.__extends(t,e);function t(){var t=e.call(this)||this;t.save=function(){var e=t.props,s=e.possibleValues,r=e.onSave;var a=t.state.selectedValues;r(a||[]);t.setState({modalOpen:false})};t.isRowDisabled=function(e){var s=t.props,r=s.isRowDisabled,a=s.allowEmpty;var i=t.state.selectedValues;var l=r?r(e):false;if(a||i.length>1)return l;return i.includes(e)&&!l};t.state={};return t}t.specialize=function(){return t};t.prototype.initStateFromProps=function(e){var t=e.values,s=e.possibleValues;if(t&&s){this.setState({selectedValues:t})}};t.prototype.componentWillReceiveProps=function(e){this.initStateFromProps(e)};t.prototype.componentDidMount=function(){this.initStateFromProps(this.props)};t.prototype.renderModal=function(){var e=this;var t=this.props,s=t.possibleValues,r=t.modalTitle,a=t.equals,i=t.values,l=t.isRowDisabled,n=t.getTitle,o=t.hideButtons,u=t.modalDescription,c=t.className;var p=this.state,d=p.selectedValues,m=p.modalOpen;if(!m)return null;var v=suggestions_list_1.SuggestionsList.specialize();return React.createElement(modal_1.Modal,{className:classNames("multi-selector-modal",c),onEnter:this.save,onClose:function(){return e.setState({modalOpen:false})},title:r},u?u:null,React.createElement(v,{items:s,selectedItems:d||[],onChange:function(t){return e.setState({selectedValues:t})},labelizeItem:n?n:String,isItemDisabled:this.isRowDisabled,equals:a,hideButtons:o}),React.createElement("div",{className:"buttons right"},React.createElement(button_1.Button,{type:"primary",title:strings_1.STRINGS.ok,onClick:this.save})))};t.prototype.renderValues=function(){var e=this.props,t=e.values,s=e.layout,r=e.getTitle,a=e.placeHolder;if(!t||!t.length)return a||strings_1.STRINGS.none;if(s==="horizontal"){return t.map(function(e){return r?r(e):e}).join(", ")}else if(s==="vertical"){return t.map(function(e,t){return React.createElement("div",{className:"item",key:t},r?r(e):e)})}return null};t.prototype.render=function(){var e=this;var t=this.props,s=t.values,r=t.placeHolder,a=t.getTitle,i=t.className,l=t.disabled,n=t.layout;return React.createElement(caret_button_1.CaretButton,{className:classNames("multi-selector",n,i,{disabled:l}),onClick:function(){if(l)return;e.setState({modalOpen:true})},svg:Icons.FULL_EDIT},this.renderValues(),this.renderModal())};t.defaultProps={layout:"horizontal",allowEmpty:true};return t}(React.Component);exports.MultiSelector=MultiSelector;